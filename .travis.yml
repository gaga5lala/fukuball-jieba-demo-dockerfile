sudo: required
services:
  - docker
before_install:
  - version=$(git rev-parse --short HEAD)
  - docker build -t gaga5lala/fukuball-jieba-demo:$version .
script:
  - docker images gaga5lala/fukuball-jieba-demo
# - echo "version: $version"
# - echo "# invisiable variable"
# - echo "username: $DOCKER_USERNAME"
# - echo "password: $DOCKER_PASSWORD"
after_success:
  - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";
  - export REPO=gaga5lala/fukuball-jieba-demo
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO
